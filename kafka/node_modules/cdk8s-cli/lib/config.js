"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.addImportToConfig = exports.readConfigSync = exports.HelmChartApiVersion = exports.SynthesisFormat = void 0;
const fs = __importStar(require("fs-extra"));
const yaml = __importStar(require("yaml"));
const CONFIG_FILE = 'cdk8s.yaml';
var SynthesisFormat;
(function (SynthesisFormat) {
    SynthesisFormat["PLAIN"] = "plain";
    SynthesisFormat["HELM"] = "helm";
})(SynthesisFormat = exports.SynthesisFormat || (exports.SynthesisFormat = {}));
var HelmChartApiVersion;
(function (HelmChartApiVersion) {
    HelmChartApiVersion["V1"] = "v1";
    HelmChartApiVersion["V2"] = "v2";
})(HelmChartApiVersion = exports.HelmChartApiVersion || (exports.HelmChartApiVersion = {}));
function readConfigSync() {
    if (fs.existsSync(CONFIG_FILE)) {
        const config = {
            ...yaml.parse(fs.readFileSync(CONFIG_FILE, 'utf-8')),
        };
        return config;
    }
    return undefined;
}
exports.readConfigSync = readConfigSync;
async function addImportToConfig(source) {
    var _a, _b;
    if (!fs.existsSync(CONFIG_FILE)) {
        // cdk8s import might be executed outside of an application (i.e without a config file)
        return;
    }
    let curConfig = yaml.parse(fs.readFileSync(CONFIG_FILE, 'utf-8'));
    const curImports = (_a = curConfig.imports) !== null && _a !== void 0 ? _a : [];
    if (!curImports.includes(source)) {
        const importsList = (_b = curConfig.imports) !== null && _b !== void 0 ? _b : [];
        importsList.push(source);
        let config = {
            ...curConfig,
            imports: importsList,
        };
        await fs.outputFile(CONFIG_FILE, yaml.stringify(config));
    }
}
exports.addImportToConfig = addImportToConfig;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NvbmZpZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZDQUErQjtBQUMvQiwyQ0FBNkI7QUFHN0IsTUFBTSxXQUFXLEdBQUcsWUFBWSxDQUFDO0FBZWpDLElBQVksZUFHWDtBQUhELFdBQVksZUFBZTtJQUN6QixrQ0FBZSxDQUFBO0lBQ2YsZ0NBQWEsQ0FBQTtBQUNmLENBQUMsRUFIVyxlQUFlLEdBQWYsdUJBQWUsS0FBZix1QkFBZSxRQUcxQjtBQUVELElBQVksbUJBR1g7QUFIRCxXQUFZLG1CQUFtQjtJQUM3QixnQ0FBUyxDQUFBO0lBQ1QsZ0NBQVMsQ0FBQTtBQUNYLENBQUMsRUFIVyxtQkFBbUIsR0FBbkIsMkJBQW1CLEtBQW5CLDJCQUFtQixRQUc5QjtBQWtCRCxTQUFnQixjQUFjO0lBQzVCLElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsRUFBRTtRQUM5QixNQUFNLE1BQU0sR0FBRztZQUNiLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsQ0FBQztTQUNyRCxDQUFDO1FBRUYsT0FBTyxNQUFNLENBQUM7S0FDZjtJQUVELE9BQU8sU0FBUyxDQUFDO0FBQ25CLENBQUM7QUFWRCx3Q0FVQztBQUVNLEtBQUssVUFBVSxpQkFBaUIsQ0FBQyxNQUFjOztJQUVwRCxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsRUFBRTtRQUMvQix1RkFBdUY7UUFDdkYsT0FBTztLQUNSO0lBRUQsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO0lBRWxFLE1BQU0sVUFBVSxHQUFHLE1BQUEsU0FBUyxDQUFDLE9BQU8sbUNBQUksRUFBRSxDQUFDO0lBQzNDLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFO1FBQ2hDLE1BQU0sV0FBVyxHQUFHLE1BQUEsU0FBUyxDQUFDLE9BQU8sbUNBQUksRUFBRSxDQUFDO1FBQzVDLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDekIsSUFBSSxNQUFNLEdBQUc7WUFDWCxHQUFHLFNBQVM7WUFDWixPQUFPLEVBQUUsV0FBVztTQUNyQixDQUFDO1FBQ0YsTUFBTSxFQUFFLENBQUMsVUFBVSxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7S0FDMUQ7QUFDSCxDQUFDO0FBbkJELDhDQW1CQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCAqIGFzIHlhbWwgZnJvbSAneWFtbCc7XG5pbXBvcnQgeyBMYW5ndWFnZSB9IGZyb20gJy4vaW1wb3J0L2Jhc2UnO1xuXG5jb25zdCBDT05GSUdfRklMRSA9ICdjZGs4cy55YW1sJztcblxuZXhwb3J0IGludGVyZmFjZSBJbXBvcnRTcGVjIHtcbiAgcmVhZG9ubHkgbW9kdWxlTmFtZVByZWZpeD86IHN0cmluZztcbiAgcmVhZG9ubHkgc291cmNlOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmFsaWRhdGlvbkNvbmZpZyB7XG4gIHJlYWRvbmx5IHBhY2thZ2U6IHN0cmluZztcbiAgcmVhZG9ubHkgdmVyc2lvbjogc3RyaW5nO1xuICByZWFkb25seSBjbGFzczogc3RyaW5nO1xuICByZWFkb25seSBpbnN0YWxsRW52PzogeyBba2V5OiBzdHJpbmddOiBhbnkgfTtcbiAgcmVhZG9ubHkgcHJvcGVydGllcz86IHsgW2tleTogc3RyaW5nXTogYW55IH07XG59XG5cbmV4cG9ydCBlbnVtIFN5bnRoZXNpc0Zvcm1hdCB7XG4gIFBMQUlOID0gJ3BsYWluJyxcbiAgSEVMTSA9ICdoZWxtJyxcbn1cblxuZXhwb3J0IGVudW0gSGVsbUNoYXJ0QXBpVmVyc2lvbiB7XG4gIFYxID0gJ3YxJyxcbiAgVjIgPSAndjInLFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFN5bnRoQ29uZmlnIHtcbiAgcmVhZG9ubHkgZm9ybWF0PzogU3ludGhlc2lzRm9ybWF0O1xuICByZWFkb25seSBjaGFydEFwaVZlcnNpb24/OiBIZWxtQ2hhcnRBcGlWZXJzaW9uO1xuICByZWFkb25seSBjaGFydFZlcnNpb24/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29uZmlnIHtcbiAgcmVhZG9ubHkgYXBwPzogc3RyaW5nO1xuICByZWFkb25seSBsYW5ndWFnZT86IExhbmd1YWdlO1xuICByZWFkb25seSBvdXRwdXQ/OiBzdHJpbmc7XG4gIHJlYWRvbmx5IGltcG9ydHM/OiBzdHJpbmdbXTtcbiAgcmVhZG9ubHkgcGx1Z2luc0RpcmVjdG9yeT86IHN0cmluZztcbiAgcmVhZG9ubHkgdmFsaWRhdGlvbnM/OiBzdHJpbmcgfCBWYWxpZGF0aW9uQ29uZmlnW107XG4gIHJlYWRvbmx5IHN5bnRoQ29uZmlnPzogU3ludGhDb25maWc7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWFkQ29uZmlnU3luYygpOiBDb25maWcgfCB1bmRlZmluZWQge1xuICBpZiAoZnMuZXhpc3RzU3luYyhDT05GSUdfRklMRSkpIHtcbiAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAuLi55YW1sLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhDT05GSUdfRklMRSwgJ3V0Zi04JykpLFxuICAgIH07XG5cbiAgICByZXR1cm4gY29uZmlnO1xuICB9XG5cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZEltcG9ydFRvQ29uZmlnKHNvdXJjZTogc3RyaW5nKSB7XG5cbiAgaWYgKCFmcy5leGlzdHNTeW5jKENPTkZJR19GSUxFKSkge1xuICAgIC8vIGNkazhzIGltcG9ydCBtaWdodCBiZSBleGVjdXRlZCBvdXRzaWRlIG9mIGFuIGFwcGxpY2F0aW9uIChpLmUgd2l0aG91dCBhIGNvbmZpZyBmaWxlKVxuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCBjdXJDb25maWcgPSB5YW1sLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhDT05GSUdfRklMRSwgJ3V0Zi04JykpO1xuXG4gIGNvbnN0IGN1ckltcG9ydHMgPSBjdXJDb25maWcuaW1wb3J0cyA/PyBbXTtcbiAgaWYgKCFjdXJJbXBvcnRzLmluY2x1ZGVzKHNvdXJjZSkpIHtcbiAgICBjb25zdCBpbXBvcnRzTGlzdCA9IGN1ckNvbmZpZy5pbXBvcnRzID8/IFtdO1xuICAgIGltcG9ydHNMaXN0LnB1c2goc291cmNlKTtcbiAgICBsZXQgY29uZmlnID0ge1xuICAgICAgLi4uY3VyQ29uZmlnLFxuICAgICAgaW1wb3J0czogaW1wb3J0c0xpc3QsXG4gICAgfTtcbiAgICBhd2FpdCBmcy5vdXRwdXRGaWxlKENPTkZJR19GSUxFLCB5YW1sLnN0cmluZ2lmeShjb25maWcpKTtcbiAgfVxufSJdfQ==